{% extends 'include/base.html' %}
{% load static %}
{% block body_content %}

<!-- Header Section-->
<section class="dashboard-header">


<div class="mt-1">
    <div class="container">

		<div class="create-box">
		<h2 class="task">User Information

		<div class="projectbox">
		<a href="#" data-toggle="modal" data-target="#add-user" class="btn text-uppercase btn-success btn-rounded">Add User</a>

		</div>   </h2>

	 <div class="reviews task-table">

                <table id="example" style="width: 100%;" class="table table-striped">
                    <thead>
                        <tr>
                            <th>S.no</th>
                            <th>Email ID</th>
                            <th>User Name</th>
                            <th>Role</th>
                            <th>Country</th>
                            <th>City</th>
                            <th>Branch</th>
                            <th>Edit</th>
                            <th style="display: block!important;">Status</th>
                        </tr>
                    </thead>
                    <tbody>
                    {% for data in get_user%}
                        <tr>
                            <td>{{forloop.counter}}
                            <td>{{data.userx.email}}</td>
                            <td>
                               {{data.userx.username}}
                            </td>
                            <td>{{data.role}}</td>
                            <td>{{data.country}}</td>
                            <td>{{data.city}}</td>
                            <td>{{data.branch}}</td>

                            <td>
<!--                                {{data.id}}-->
                                <button  data-toggle="modal" data-target="#edit-user" data-user_id="{{data.id}}" class="btn btn-dark edit_user" >Edit</button>
<!--                                <a href="#" class="btn btn-dark" data-user_id="{{data.id}}">Delete</a>-->

                                <button  data-toggle="modal" data-target="#delete-user" data-user_id="{{data.id}}" data-user_name="{{data.userx.username}}" class="btn btn-dark delete_user" >Delete</button>

                            </td>
                            <td>
<!--                                {{data.userx.is_active}}-->
                                {% if data.userx.is_active %}
                                <label class="toggle">
                                    <input class="toggle-checkbox approve" type="checkbox" checked="true" userstatus-id="{{data.id}}" userstatus="{{data.userx.is_active}}" >
                                    <div class="toggle-switch"></div>
                                </label>
                                {% else %}
                                <label class="toggle">
                                    <input class="toggle-checkbox approve" type="checkbox" userstatus-id="{{data.id}}" userstatus="{{data.userx.is_active}}" >
                                    <div class="toggle-switch check" ></div>
                                 </label>
                                {% endif %}
                            </td>

                        </tr>
			        {% endfor %}
                    </tbody>
                </table>
           </div>
		</div>
		</div>
    </div>

</section>


<!-- edit user Modal -->
<div class="modal fade" id="edit-user" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">

      <div class="modal-body">






    </div>
  </div>
</div>
</div>


<!-- add new user Modal -->
<div class="modal fade" id="add-user" tabindex="-1" role="dialog" aria-labelledby="add-userModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">

      <div class="modal-body">
	  <h5>Add  New User <button type="button" class="close close-rounded" data-dismiss="modal" aria-label="Close">
        <i class="fas fa-times-circle"></i>
        </button></h5>

		<div class="form-project">
            <form method="POST" action="" id="" class="contact_form">
                {% csrf_token %}


                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                        <label>*User Name</label>
<!--                            {{user_form.username}}-->
                	 <input class="form-control" type="text" name="username" placeholder="enter user name" />
                        </div>

                    </div>

                    <div class="col-md-6">
                        <div class="form-group">
                        <label>Email</label>
<!--                            {{user_form.email}}-->
                	 <input class="form-control" type="email" name="email" placeholder="Example@gmail.com" />
                        </div>

                    </div>

                    <div class="col-md-6">
                        <div class="form-group">
                        <label>Phone Number</label>
<!--                            {{user_profile_form.phone_no}}-->
                	 <input class="form-control" type="number" name="phone"placeholder="enter phone number" />
                        </div>

                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                        <label>*Password</label>
<!--                            {{user_form.password}}-->
                	<input class="form-control" type="password" name="password" placeholder="" />
                    </div>

                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                        <label>*Role</label>
<!--                            {{user_profile_form.role}}-->
                            <select class="form-control" name="role">
<!--                                {% if get_role %}-->
<!--                                {% for data in get_role %}-->
<!--                                <option value="{{data.id}}">{{data.role_name}}</option>-->
<!--                                {% endfor %}-->
<!--                                {% endif %}-->
                                     <option value="Admin">Admin</option>
                                <option value="Task manager">Task manager</option>
                                <option value="Employee">Employee</option>
                                <option value="Project manager">Project manager</option>
                            </select>
                        </div>

                    </div>


                    <div class="col-md-6">
                        <div class="form-group">
                        <label>Branch</label>
<!--                            {{user_profile_form.country}}-->
                    	<input class="form-control" type="text" name="branch" placeholder="enter branch name" />
                        </div>
                    </div>

                     <div class="col-md-6">
                        <div class="form-group">
                        <label>City</label>
<!--                            {{user_profile_form.city}}-->
                    	<input class="form-control" type="text" name="city" placeholder="enter city name" />
                        </div>
                    </div>


                    <div class="col-md-6">
                        <div class="form-group">
                        <label>Country</label>
<!--                            {{user_profile_form.country}}-->
                    	<input class="form-control" type="text" name="country" placeholder="enter country name" />
                        </div>
                    </div>


                    <div class="col-md-12">

                        <div class="form-group">
                        <label>Address</label>
<!--                            {{user_profile_form.address}}-->
                	    <textarea class="form-control height" name="address" placeholder="enter address"></textarea>
                        </div>

                    </div>

                        <div class="col-md-12">
                        <button type="submit" class="btn text-uppercase btn-success btn-rounded">Save</button>
                        </div>
                </div>
             </form>

      </div>

    </div>
  </div>
</div>
</div>
{% endblock %}
{% block script %}

<script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.js"></script>
<script type="text/javascript">


//---------Edit User start----------------
$(document).on("click",".edit_user",function(){
var id = $(this).data("user_id");
console.log(id)
$.ajax({
  method:"GET",
  url :"/account/edit/"+id,
  dataType:"html",

  success:function(data)
  {
     $("#edit-user .modal-body").html(data);
  }
});
});
//---------Edit User end----------------


//---------delete User start----------------
$(document).ready(function(){
  $(".delete_user").click(function(){
var delete_value = $(this).data("user_id");
console.log(delete_value)
var user_name=$(this).data("user_name");
     swal({
          title: "Are you sure?",
          text: "You want to delete "+user_name+ " !",
          type: "warning",
          showCancelButton: true,
          confirmButtonClass: 'btn-danger',
          confirmButtonText: 'Yes, delete it!',
          closeOnConfirm: false,
          //closeOnCancel: false
          },
          function(isConfirm){
         if (isConfirm) {
            $.ajax({
                url: "http://digimonk.co:2233/account/delete/"+delete_value,
                type: "POST",
                success: function () {
                    swal("Done!","It was succesfully deleted!","success");
                        location.reload();
                }
            });
          }
          else{
                swal("Cancelled", "Your imaginary file is safe :)", "error");
          }
       })
      });
});

//---------delete User end----------------


//---------Block and Unblock User Start----------------
         $(document).on('click', ".approve", function (e) {
         var userstatusid = $(e.currentTarget).attr("userstatus-id");
         var userstatus = $(e.currentTarget).attr('userstatus');
         console.log(userstatusid);
         console.log(userstatus);

         if(userstatus == 'True'){
         varstatus = 'Deactive';
         }
         else{
         varstatus = 'Active';
         }
         swal({
          title: 'Are you sure?',
          text: varstatus+' this',
          icon: 'warning',
          buttons: {
            cancel: {
              text: "Cancel",
              value: null,
              visible: true,
              closeModal: true,
            },
            confirm: {
              text: "OK",
              value: true,
              visible: true,
              closeModal: true
            },
          }
         },
           function(isConfirm){
         if (isConfirm) {
                   var dataString = 'userstatusid='+userstatusid+'&userstatus='+userstatus;
                   var token = '{{csrf_token}}';
                   var geturl = window.location.href;

                   var url_in_array = geturl.split("/");
                   var set_url = url_in_array[2];
            $.ajax({
                  method:"POST",
                  headers: { "X-CSRFToken": token },
                 url: "http://"+set_url+"/account/userstatus",
                 data: dataString,
                 dataType:"json",
                 cache: false,
                success: function (data) {
                    swal("Done!","succesfully Edited!","success");
                        location.reload();
                         }
                });
              }
              else{
                    swal("Cancelled", "Your status is safe :)", "error");
              }
           });

           });
         //---------Block and Unblock User End----------------

</script>
{% endblock %}